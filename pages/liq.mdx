# Liquidation engine

## Why Liquidation Design Matters

Every liquidation engine has to make a tradeoff: liquidate quickly enough to protect solvency, while keeping guardrails against oracle misprints, or extremely short lived price spikes

In a volatile market, bad oracle data or sudden price wicks can create sudden crises. A DEX that instantly liquidates based on a single bad price tick can wipe out healthy traders. Which can also be dangerous for the protocol itself.

## How Drift handles speed

Drift’s liquidation engine dynamically adjusts liquidation speed based on how far a price print deviates from a short-term TWAP (Time-Weighted Average Price). When prices spike far away from the TWAP, the liquidation window becomes longer, giving the market time to confirm whether that move is real or noise. When the price stabilizes and aligns closer to the TWAP, liquidations move faster again. 

From empirical data, even a delay of less than a few slots a can be enough to prevent false liquidations during a temporary wick. The goal isn’t to pause liquidations indefinitely, but to smooth out erratic behavior. 

## How Drift handles price

Liquidations on Drift aren’t triggered directly by the mark price. As mentioned above, we use a five-minute average price as a reference point for liquidation thresholds. 

During a flash event, the system effectively waits and sees if the move holds. If the price snaps back, healthy accounts stay safe. If it sustains for long enough, Drift gradually initiates partial liquidation. 

## Partial Liquidations

To further limit risk and reduce the severity of liquidation events, Drift uses **partial liquidation**. Instead of closing an entire position at once, the system liquidates portions over time, throttled across multiple slots. This gives the account a chance to recover as new oracle prices arrive, while ensuring the system remains solvent.

The buffer system ensures that users aren’t liquidated right back at maintenance margin. Instead, Drift places liquidated accounts slightly behind a safe margin buffer, far enough to reduce immediate risk but close enough to stay competitive for traders using leverage.

## Insurance Fund as a safety net

Even with all these protections, extreme events can still create negative balances. That’s where Drift’s **Insurance Fund** comes in. It’s the protocol’s first backstop against insolvency.

The Insurance Fund covers trader losses that exceed their account balances. Anyone can stake assets, like USDC, SOL, BTC, or ETH, into the fund and earn a share of Drift’s trading and liquidation fees.

### When It’s Used

- **Spot markets:** Covered in full.
- **Perpetual markets:** Covered up to a set per-market limit.

Each asset has its own Insurance Fund. For example, the USDC fund backs perps and general exchange operations, while SOL, BTC, and ETH funds cover borrow/lend losses specific to those assets.

The fund accumulates capital through:

-User staking (deposits)

-A portion of trading, borrowing, and liquidation fees 

## How Bankruptcy Resolution Works

Drift follows a clear hierarchy:

1. **External Insurance Fund** (USDC) covers the debt up to its per market limit.
2. **Internal Insurance** (the vAMM’s lifetime profit for that market) covers remaining losses.
3. If both are exhausted, **socialized loss** applies via a temporary funding adjustment.

This structure ensures that insolvency events are handled fairly and predictably. The system aims to keep socialized losses as close to zero as possible. Historically, these have been minuscule, often less than 0.2% of total liquidation volume.

## In Summary

Drift’s liquidation engine and Insurance Fund are designed to work hand in hand:

1. **Dynamic liquidation speed:** Adjusts with TWAP deviation to avoid reaction to erroneous moves.
2. **Partial liquidations:** Break up liquidations across slots for fairness and stability.
3. **Oracle guardrails:** Use moving averages instead of single ticks to prevent misfires.
4. **Insurance Fund coverage:** Absorbs negative balances before any socialized loss.
